<krpano version="1.19.13" dbgi18n="false" debugmode="false" >


    <!-- Multilingual support for krpano viewer = internationalization = i18n -->

    <!-- i18n language setting for vtourskin  -->
    <include url="i18n.vskin.xml" if="i18n_lang !== null " />   

    <!-- i18n setting for all languages using in my scenes   -->
    <include url="i18n__.xml"/>   
    
    <!-- selected language dictionary -->
    <include url="i18n__%$i18n_lang%.xml" if="i18n_lang !== null " />   


    <action name="dbg_i18n">
        if (dbgi18n == true, %1);
    </action>


    <!-- LanguageSelector

        "Constructor": (it's like OOP )
            init(%%1, %%2, selector_name, lang_list ) 
                selector_name   - name of the LnaguageSelector object
                lang_list       - list of languages, used for the selector. The first language in list is taken as the basic
                e.g.:   LanguageSelector.init(%%1,%%2,i18n.select, en|en-US|sk|de);
        "Destructor":   
            delete( select_name )

        "Class" methods:
            load('lang_to_load')
                lang_to_load    - 'de'
                    e.g.:   LanguageSelector.load('de'); 
                    note: though krpano code uses lowercase only, it's just a visual aid to 

            show_vskin()
                shows i18n language selector defined in the i18n\i18n.vskin.xml file;
                position of the selector is based on the mouse.x / mouse.y click;
                '%0_isloading' variable is used in < skin_settings loadingtext="" > element of i18n\i18n.vskin.xml;  
                
        "Object" methods 
                Use them when multiple language selectors are required with different behaviour.
            init_time() - starts the timer
            elapsed()   - elapsed time from timer start
            log()       - loggs the actions 
            load('lang_to_load')
                lang_to_load    - 'de' 
                    e.g.:   i18n.select.load('de');
        -->
    <LanguageSelector
        init="
            set(%3.alpha, 0.0);
            set(%3.enable, false);
            set(%3.visible, false);
            set(%3.logging, true);
            set(%3.key, '');
            set(%3.txt, '');
            set(%3.result, '');
            set(%3.logaction, init);
            txtsplit(%4,'|', %3.languages);
            set(%3.lang, get(%3.languages[0].value));

            set(%3.init_time,
                set(%3.tick_0, calc(timertick BOR 0));
                set(%3.logaction, init_time); %3.log();
                );
            set(%3.elapsed,
                sub(%3.sec, get(timertick), get(%3.tick_0));
                div(%3.sec, %3.sec, 1000.0);
                roundval(%3.sec, 2);
                );
            set(%3.log,
                if(%3.logging,
                    %3.elapsed(); 
                    set(%3.tick, calc(timertick BOR 0));
                    trace('LOG:  %3.', %3.logaction,': ', ' tick=', %3.tick, ' elapsed=', %3.sec, '  ', get(%3.output));
                    set(%3.output, '');
                    );
                );
            set(%3.list_langs,
                if (%3.languages.count , 
                    delete(%.result);
                    for(set(i,0), i LT %3.languages.count, inc(i)   ,
                        trace(%0 %1 %2 %3 , ' i=', i,  ' value=', %3.languages[get(i)].value,); 
                        );
                    );
                );
            set(%3.load,
                showlog(true);
                trace(%0 %1 %2 %3 , ' .load', ' i18n_lang=', i18n_lang ); 
                LanguageSelector.load(%1);              
                );
            %3.init_time();
            " 
        show_vskin="
            copy(layer[lang_selector].x, mouse.x);
            calc(layer[lang_selector].y, ((mouse.y + layer[lang_selector].height + 70) LT stageheight) ? mouse.y : stageheight - layer[lang_selector].height - 70  );
            dbg_i18n( trace(%0 %1 %2 %3 ,' lang_selector x/y= ', layer[lang_selector].x, '/', layer[lang_selector].y););
            set(layer[lang_selector].visible, 'true');
            "
        load="
            dbg_i18n( trace(%0 %1 %2 %3, ' i18n_lang=', i18n_lang, ' xml.scene=', xml.scene, ' tick=', timertick  ););
            tolower(%1);
            if(i18n_lang != null AND i18n_lang !== '%1', 
                set(i18n_lang, '%1');
                set(%0_isloading, 'true');
                set(layer[skin_loadingtext].html, '');
                loadpanoscene(tour.xml, get(xml.scene), calc('i18n_lang=' + i18n_lang), IGNOREKEEP|KEEPVIEW|KEEPMOVING, BLEND(0.5));
                set(%0_isloading, 'false');
                );              
            "
        delete="
            set(%1.logaction, delete); %1.log();
            delete(%1);
            "
        />

</krpano>