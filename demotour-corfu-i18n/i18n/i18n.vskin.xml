<krpano version="1.19-pr13">

    <!-- i18n language setting for vtourskin  -->

    <!-- skin\vtourskin.xml: loading text   -->
    <skin_settings  if="LanguageSelector.load_isloading == 'true'" loadingtext=""  />

    <!-- Enhanced contextmenu for Language selector in contextmenu. 
            note: the contextmenu.item[lang_change].caption is enhanced with the flag image
                at style[skin_lang_select].onloaded event (by now works for html5 only!)
        -->
    <contextmenu>
        <item name="lang_change"
              caption="get:i18n.ctxmenu.key[lang_change].txt"
              enabled="true"
              visible="calc:skin_settings.i18n == true ? 'true':'false'"
              separator="true"
              onclick="LanguageSelector.show_vskin();" 
              />
        <item name="skin_change"
              caption="get:i18n.ctxmenu.key[skin_change].txt"
              />
        </contextmenu>


    <!-- Language selector style (adjust to match skin style) 
            note: the contextmenu.item[lang_change].caption is enhanced with the flag image
                at style[skin_lang_select].onloaded event 
        -->
    <style name="skin_lang_select" type="text" 
        align="lefttop"
        background="true" backgroundalpha="0.2" 
        css="calc:skin_settings.design_text_css + ' text-align:left; font-style:italic; font-size:12px;'" 
        textshadow="get:skin_settings.design_text_shadow"
        html1="[img src=[sq]"  
        html2="[sq] style=[sq]width:24px; height:16px; margin:0px 0px -4px -2px; [sq] /]" 
        html5_img="" 
        onloaded="
            tolower(i18n_lang);
            calc(html5_img, html1 + flagurl + html2);
            calc(html, html5_img + html);
            callwhen(name == i18n_lang, 
                delete(txt);
                txtadd(txt, get(html5_img), ' ', get(contextmenu.item[lang_change].caption));
                copy(contextmenu.item[lang_change].caption, txt))
                );
            "
        onclick="LanguageSelector.load(get(name));set(layer[lang_selector].visible, 'false');"
        />



    <!-- My language selector setting       -->
    <layer name="lang_selector" parent="" keep="true" type="container" align="lefttop" 
        x="0" y="0" width="100" height="125" visible="false"
        bgalpha="0.1" bgcapture="true"
        onout="set(visible, 'false')"
        >
        <layer name="en"    html=" English"     flagurl="flags/en.png"      style="skin_lang_select|skin_glow" y="0" />
        <layer name="en-US" html=" US English"  flagurl="flags/en-US.png"   style="skin_lang_select|skin_glow" y="25" />
        <layer name="de"    html=" Deutsch"     flagurl="flags/de.png"      style="skin_lang_select|skin_glow" y="50" />
        <layer name="sk"    html=" Slovensky"   flagurl="flags/sk.png"      style="skin_lang_select|skin_glow" y="75" />
        <layer name="cz"    html=" &#268;esky"  flagurl="flags/cz.png"      style="skin_lang_select|skin_glow" y="100" />
    </layer>

    <!-- LanguageSelector icon in krpano skin_control_bar
            flags from https://www.iconfinder.com 
        -->
    <layer name="skin_layer" >
        <layer name="skin_control_bar">
            <layer name="skin_control_bar_buttons" >
                <layer name="skin_btn_i18n"  if="design !== 'design_ultra_light'"     
                    style="skin_base|skin_glow" 
                    url="flags/%$i18n_lang%.png"  
                    align="left"  x="75"   y="0"  scale="1.0" 
                    ondown2="skin_showthumbs(false); LanguageSelector.show_vskin();" 
                    visible="calc:skin_settings.i18n == true ? 'true':'false'" />
                <layer name="skin_btn_i18n"  if="design === 'design_ultra_light'"     
                    style="skin_base|skin_glow" 
                    type="text"
                    html="get:i18n_lang"  
                    align="left"  x="75"   y="0"  scale="1.0" 
                    ondown2="skin_showthumbs(false); LanguageSelector.show_vskin();"
                    visible="calc:skin_settings.i18n == true ? 'true':'false'" />
                </layer>
            </layer>
        </layer>

    <!-- overridden/enhanced action from skin/vtourskin.xml for LanguageSelector icon  -->
    <action name="skin_arrange_buttons">
        calc(show_selbuttons, scene.count GT 1);
        calc(show_thumbutton, skin_settings.thumbs == true);
        calc(show_mapbutton,  skin_settings.maps == true);
        calc(show_i18nbutton, skin_settings.i18n == true);
        calc(show_gyrobutton, plugin[skin_gyro].available == true AND (view.vlookatrange == 180 OR lp_scene === xml.scene));
        calc(show_vrbutton,   webvr.isavailable == true);
        calc(show_fsbutton,   device.fullscreensupport == true);

        set(lpos,6);
        set(cpos,0);
        if(show_gyrobutton, dec(cpos,20));
        if(show_vrbutton, dec(cpos,24));
        set(rpos,6);

        calc(show_dirbuttons, !device.mobile AND ((area.pixelwidth + 2*cpos) GT 520));

        copy(layer[skin_btn_navi].visible, show_dirbuttons);

        copy(layer[skin_btn_prev].visible, show_selbuttons);
        copy(layer[skin_btn_next].visible, show_selbuttons);
        if(show_selbuttons, inc(lpos,44); inc(rpos,44); );

        copy(layer[skin_btn_thumbs].visible, show_thumbutton);
        copy(layer[skin_btn_thumbs].x, lpos);
        if(show_thumbutton, inc(lpos,40));

        copy(layer[skin_btn_i18n].visible, show_i18nbutton);
        copy(layer[skin_btn_i18n].x, lpos);
        if(show_i18nbutton, inc(lpos,40));

        copy(layer[skin_btn_map].visible, show_mapbutton);
        copy(layer[skin_btn_map].x, lpos);
        if(show_mapbutton, inc(lpos,40));

        if(show_dirbuttons,
            copy(layer[skin_btn_navi].x, cpos);
            inc(cpos,140);

            set(layer[skin_btn_gyro].align, center);
            copy(layer[skin_btn_gyro].visible, show_gyrobutton);
            copy(layer[skin_btn_gyro].x, cpos);
            if(show_gyrobutton, inc(cpos,48));

            set(layer[skin_btn_vr].align, center);
            copy(layer[skin_btn_vr].visible, show_vrbutton);
            copy(layer[skin_btn_vr].x, cpos);
            if(show_vrbutton, inc(cpos,80));
          ,
            set(layer[skin_btn_gyro].align, left);
            copy(layer[skin_btn_gyro].visible, show_gyrobutton);
            copy(layer[skin_btn_gyro].x, lpos);
            if(show_gyrobutton, inc(lpos,40));

            set(layer[skin_btn_vr].align, left);
            copy(layer[skin_btn_vr].visible, show_vrbutton);
            copy(layer[skin_btn_vr].x, lpos);
            if(show_vrbutton, inc(lpos,80));
          );

        copy(layer[skin_btn_hide].x, rpos);
        inc(rpos,40);

        copy(layer[skin_btn_fs].visible, show_fsbutton);
        copy(layer[skin_btn_fs].x, rpos);
        if(show_fsbutton, inc(rpos,40));
    </action>

    <!-- overridden/enhanced action from skin/vtourskin.xml for thumbnail tooltip  -->
	<action name="skin_addthumbs">
		if(skin_settings.thumbs == false,
			set(layer[skin_btn_thumbs].visible,false);
		  ,
			copy(thumbwidth, skin_settings.thumbs_width);
			copy(thumbheight, skin_settings.thumbs_height);
			copy(thumbpadding, skin_settings.thumbs_padding);
			copy(thumbcrop, skin_settings.thumbs_crop);

			add(thumbxoffset, thumbwidth, thumbpadding);
			mul(thumbxcenter, thumbxoffset, 0.5);
			mul(thumbbarwidth, thumbxoffset, scene.count);
			add(thumbbarwidth, thumbpadding);
			add(thumbbarheight, thumbpadding, thumbheight);
			add(thumbbarheight, thumbpadding);

			if(skin_settings.thumbs_scrollindicator,
				copy(layer[skin_thumbs_scrollindicator].y, thumbbarheight);
				add(thumbbarheight, layer[skin_thumbs_scrollindicator].height);
			);

			copy(layer[skin_thumbs].height, thumbbarheight);
			copy(layer[skin_thumbs].width, thumbbarwidth);

			mul(halfheight, thumbbarheight, 0.5);
			copy(layer[skin_thumbs_scrollleft].y, halfheight);
			copy(layer[skin_thumbs_scrollright].y, halfheight);

			set(thumb_cnt,0);
			for(set(i,0), i LT scene.count, inc(i),
				inc(thumb_cnt);
				txtadd(thumbname,'skin_thumb_',get(i));
				addlayer(get(thumbname));
				copy(layer[get(thumbname)].url, scene[get(i)].thumburl);
				set(layer[get(thumbname)].keep, true);
				set(layer[get(thumbname)].parent, 'skin_thumbs');
				set(layer[get(thumbname)].align, lefttop);
				copy(layer[get(thumbname)].crop, thumbcrop);
				copy(layer[get(thumbname)].width, thumbwidth);
				copy(layer[get(thumbname)].height, thumbheight);
				mul(thumbx, i, thumbxoffset);
				add(thumbx, thumbpadding);
				copy(layer[get(thumbname)].x, thumbx);
				copy(layer[get(thumbname)].y, thumbpadding);
				add(scene[get(i)].thumbx, thumbx, thumbxcenter);
				copy(scene[get(i)].thumby, thumbpadding);
				set(layer[get(thumbname)].linkedscene, get(scene[get(i)].name) );
				set(layer[get(thumbname)].onclick, copy(layer[skin_thumbborder].parent, name); skin_loadscene(get(linkedscene),get(skin_settings.loadscene_blend)); );

			<!-- this original code replaced by i18n_scene_title
				if(skin_settings.tooltips_thumbs,
					set(layer[get(thumbname)].tooltip, get(scene[get(i)].title) ); 
					layer[get(thumbname)].loadstyle(skin_tooltips);
				  );
				-->
				delete(i18n_scene_title);
				txtadd(i18n_scene_title, 'i18n.', get(scene[get(i)].name), '.key[title].txt');
				copy(i18n_scene_title, get(i18n_scene_title));
				if(i18n_scene_title == null, 
					set(i18n_scene_title, get(scene[get(i)].title));
					);
				dbg_i18n( trace(%0 %1 %2 , ' i18n_lang=', i18n_lang, ' i18n_scene_title=', get(i18n_scene_title), ' tick=', timertick); );
				if(skin_settings.tooltips_thumbs,
					set(layer[get(thumbname)].tooltip, get(i18n_scene_title));
					layer[get(thumbname)].loadstyle(skin_tooltips);
				  );


					<!-- set(layer[get(thumbtext)].html, get(scene[get(i)].title)); 
							replaced by 
						set(layer[get(thumbtext)].html, get(i18n_scene_title));
							-->
				if(skin_settings.thumbs_text,
					txtadd(thumbtext, 'skin_thumbtext_', get(i));
					addlayer(get(thumbtext));
					layer[get(thumbtext)].loadstyle(skin_thumbtext_style);
					set(layer[get(thumbtext)].keep, true);
					set(layer[get(thumbtext)].parent, get(thumbname));

					set(layer[get(thumbtext)].html, get(i18n_scene_title));

				  );
			   );

			if(thumb_cnt == 1,
				set(layer[skin_thumbs].align, 'lefttop');
			  );
		  );
	</action>

    <!-- overridden/enhanced action from skin/vtourskin.xml for skin_settings.tooltips_mapspots  -->
	<action name="skin_addmapspots">
		for(set(i,0), i LT scene.count, inc(i),
			if(scene[get(i)].lat,
				txtadd(spotname, 'spot', get(i));
				txtadd(spotclickevent, 'skin_hidetooltips(); activatespot(',get(spotname),'); skin_loadscene(', get(scene[get(i)].name), ',get(skin_settings.loadscene_blend)); skin_updatescroll(); delayedcall(0.5,skin_showmap(false));');
				copy(scene[get(i)].mapspotname, spotname);
				addspot(get(spotname), get(scene[get(i)].lat), get(scene[get(i)].lng), get(scene[get(i)].heading), false, get(spotclickevent), null);

				<!-- i18n enhancement:
					set(layer[skin_map].spot[get(spotname)].tooltip, get(scene[get(i)].title) );
					replaced by
					set(layer[skin_map].spot[get(spotname)].tooltip, get(i18n_scene_title) );
					 -->
				delete(i18n_scene_title);
				txtadd(i18n_scene_title, 'i18n.', get(scene[get(i)].name), '.key[title].txt');
				copy(i18n_scene_title, get(i18n_scene_title));
				if(i18n_scene_title == null, 
					set(i18n_scene_title, get(scene[get(i)].title));
					);
				
				if(skin_settings.tooltips_mapspots,
					set(layer[skin_map].spot[get(spotname)].tooltip, get(i18n_scene_title) );
					txtadd(layer[skin_map].spot[get(spotname)].onover, 'set(hovering,true);',  get(style[skin_tooltips].onover) );
					txtadd(layer[skin_map].spot[get(spotname)].onout,  'set(hovering,false);', get(style[skin_tooltips].onout)  );
				  );
			  );
		  );

		if(xml.scene != null,
			activatespot( get(scene[get(xml.scene)].mapspotname) );
		  ,
			activatespot(spot0);
		  );

		<!-- zoom and pan the map to see all spots at the same time -->
		zoomToSpotsExtent();
	</action>



    <!-- the 'tooltip' style - show the tooltip textfield and update its position as long as hovering -->
    <style name="tooltips"
           onover2="copy(layer[tooltip].html, tooltip);
                   set(layer[tooltip].visible, true);
                   tween(layer[tooltip].alpha, 1.0, 0.5);
                   asyncloop(hovering, copy(layer[tooltip].x,mouse.stagex); copy(layer[tooltip].y,mouse.stagey); );"
           onout2="tween(layer[tooltip].alpha, 0.0, 0.25, default, set(layer[tooltip].visible,false), copy(layer[tooltip].x,mouse.stagex); copy(layer[tooltip].y,mouse.stagey); );"
           />

    <!-- the 'tooltip' textfield -->
    <layer name="tooltip" keep="true"
           type="text"
           parent="STAGE"
           visible="false" alpha="0"
           enabled="false"
           align="lefttop"
           edge="bottom"
           oy="-20"
           background="false" backgroundcolor="0xFFFFFF" backgroundalpha="1.0"
           border="false" bordercolor="0x000000" borderalpha="1.0"
           borderwidth="1.0" roundedge="0"
           shadow="0.0" shadowrange="4.0" shadowangle="45" shadowcolor="0x000000" shadowalpha="1.0"
           textshadow="1" textshadowrange="6.0" textshadowangle="90" textshadowcolor="0x000000" textshadowalpha="1.0"
           css="text-align:center; color:#FFFFFF; font-family:Arial; font-weight:bold; font-size:12px;"
           zorder="0"
           html=""
           />

    <!-- add tooltips to skin layout -->
    <layer name="skin_layer" >
        <layer name="skin_control_bar">
            <layer name="skin_control_bar_buttons">
                <layer name="skin_btn_prev"      onloaded="loadstyle(tooltips|skin_glow);"  tooltip="Previous Pano" />
                <layer name="skin_btn_thumbs"    onloaded="loadstyle(tooltips|skin_glow);"  tooltip="Show Panos" />
                <layer name="skin_btn_i18n"      onloaded="loadstyle(tooltips|skin_glow);"  tooltip="Select Language" />

                <layer name="skin_btn_map"       onloaded="loadstyle(tooltips|skin_glow);"  tooltip="Locate On Bing Map" />
                <layer name="skin_btn_navi">
                    <layer name="skin_btn_left"  onloaded="loadstyle(tooltips|skin_glow);"  tooltip="Look Left" />
                    <layer name="skin_btn_right" onloaded="loadstyle(tooltips|skin_glow);"  tooltip="Look Right" />
                    <layer name="skin_btn_up"    onloaded="loadstyle(tooltips|skin_glow);"  tooltip="Look Up" />
                    <layer name="skin_btn_down"  onloaded="loadstyle(tooltips|skin_glow);"  tooltip="Look Down" />
                    <layer name="skin_btn_in"    onloaded="loadstyle(tooltips|skin_glow);"  tooltip="Zoom In" />
                    <layer name="skin_btn_out"   onloaded="loadstyle(tooltips|skin_glow);"  tooltip="Zoom Out" />
                </layer>
                <layer name="skin_btn_gyro"      onloaded="loadstyle(tooltips|skin_glow);"  tooltip="Gyroscope" />
                <layer name="skin_btn_vr"        onloaded="loadstyle(tooltips|skin_glow);"  tooltip="VR and 3D Support" />
                <layer name="skin_btn_fs"        onloaded="loadstyle(tooltips|skin_glow);"  tooltip="Full Screen" />
                <layer name="skin_btn_hide"      onloaded="loadstyle(tooltips|skin_glow);"  tooltip="Hide Buttons" />
                <layer name="skin_btn_show"      onloaded="loadstyle(tooltips|skin_glow);"  tooltip="Show Buttons" >
                    <layer name="skin_btn_show_icon"/>
                </layer> 
                <layer name="skin_btn_next"      onloaded="loadstyle(tooltips|skin_glow);"  tooltip="Next Pano" />
                </layer>
            </layer>
    </layer>

    <!-- previous/next scene buttons for the hidden skin mode -->
    <layer name="skin_btn_prev_fs" >
        <layer name="skin_btn_prev_fs_icon" onloaded="loadstyle(tooltips|skin_glow);"   tooltip="Previous Pano" />
    </layer>
    <layer name="skin_btn_next_fs" >
        <layer name="skin_btn_next_fs_icon" onloaded="loadstyle(tooltips|skin_glow);"   tooltip="Next Pano" />
    </layer>

</krpano>



