<krpano>
    <!-- Qui solo la logica grafica: layer, azioni, stili popup/info -->
    <!-- Esempio: -->
    <layer name="popup_bg" keep="true" type="container" align="righttop" x="-550" width="500" width.mobile="90%" height="100%" bgcolor="0x000000" bgalpha="0.9" bgroundedge="0" visible="false" zorder="999" maskchildren="true" capture="true">
        <layer name="popup_title" type="text" align="top" y="40" width="100%" bg="false" css="color:white; font-family:Arial; font-size:22px; font-weight:bold; text-align:center;" />
        <layer name="popup_content" type="html" align="top" y="100" width="95%" height="-120" bg="false" capture="true" css="overflow-y:auto; color:#fff; font-family:Arial; font-size:16px; line-height:1.6; text-align:justify; padding-right:18px; box-sizing:border-box;" />
        <layer name="popup_close" type="text" align="topleft" x="20" y="20" bg="false" html="âœ•" css="color:white; font-size:22px; font-family:Arial; cursor:pointer; background:rgba(255,255,255,0.12); padding:2px 10px 4px 10px; border-radius:50%; text-align:center; width:32px; height:32px; line-height:28px;" onclick="close_popup();" />
    </layer>
    <!-- Evento: chiudi popup cliccando fuori -->
    <events name="popup_interaction_events" keep="true" onmousedown="if(layer[popup_bg].visible, close_popup() );" />

    <!-- Azione: apertura popup info progetto -->
    <action name="open_project_info_popup" scope="local" args="titlecontent, textcontent, imageurl">
        set(layer[popup_blur].visible, true);
        set(layer[popup_blur].alpha, 0);
        tween(layer[popup_blur].alpha, 0.5, 0.4);
        set(layer[popup_bg].visible, true);
        set(layer[popup_bg].x, -550);
        set(layer[popup_title].html, get(titlecontent));
        txtadd(content_html, '<div style="margin-bottom:20px;">', get(textcontent), '</div>', '<img src="', get(imageurl), '" style="width:120px; display:block; margin:0 auto; border-radius:4px;" />');
        set(layer[popup_content].html, get(content_html));
        tween(layer[popup_bg].x, 0, 0.4, easeOutQuad);
        reset_popup_scroll();
    </action>
    <action name="open_project_info">
        open_project_info_popup(
            'Informazioni progetto',
            '<div style="margin-top:12px;">Foto sferiche e Tour virtuale (krpano) sviluppato da Giulia Tomasi.</div>',
            'hotspots/logoflora360.jpg'
        );
    </action>

    <!-- Azione: trace_yaw_pitch per debug -->
    <action name="trace_yaw_pitch" scope="local">
        trace('yaw=' + get(caller.ath) + ' pitch=' + get(caller.atv));
    </action>
    <action name="open_popup" scope="local" args="titlecontent, textcontent, imageurl">
        set(layer[popup_blur].visible, true);
        set(layer[popup_blur].alpha, 0);
        tween(layer[popup_blur].alpha, 0.5, 0.4);
        set(layer[popup_bg].visible, true);
        set(layer[popup_bg].x, -550);
        set(layer[popup_title].html, get(titlecontent));
        txtadd(content_html, '<img src="', get(imageurl), '" style="width:100%; height:auto; display:block; margin:0 auto 20px auto; border-radius:4px;" />', '<div>', get(textcontent), '</div>');
        set(layer[popup_content].html, get(content_html));
        tween(layer[popup_bg].x, 0, 0.4, easeOutQuad);
        reset_popup_scroll();
    </action>
    <action name="close_popup">
        tween(layer[popup_blur].alpha, 0.0, 0.4);
        tween(layer[popup_bg].x, -550, 0.4, easeInQuad, set(layer[popup_bg].visible, false); set(layer[popup_blur].visible, false); set(layer[popup_content].html, ''); set(layer[popup_bg].x, -550); reset_popup_scroll(); );
    </action>
    <action name="reset_popup_scroll" type="Javascript"><![CDATA[
        var layer = krpano.get("layer[popup_content]");
        if(layer && layer.sprite) {
            layer.sprite.scrollTop = 0;
            if(layer.sprite.scrollTo) layer.sprite.scrollTo(0,0);
            setTimeout(function(){
                if(layer.sprite) {
                    layer.sprite.scrollTop = 0;
                    if(layer.sprite.scrollTo) layer.sprite.scrollTo(0,0);
                }
            }, 100);
            setTimeout(function(){
                if(layer.sprite) layer.sprite.scrollTop = 0;
            }, 300);
        }
    ]]></action>
</krpano>